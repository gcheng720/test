{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function get() {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  }\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar react_1 = __importStar(require(\"react\"));\nvar immutable_1 = __importDefault(require(\"immutable\"));\nvar classnames_1 = __importDefault(require(\"classnames\"));\nvar styles_1 = require(\"@mui/styles\");\nvar material_1 = require(\"@mui/material\");\nvar draft_js_1 = require(\"draft-js\");\nvar Toolbar_1 = __importDefault(require(\"./components/Toolbar\"));\nvar Link_1 = __importDefault(require(\"./components/Link\"));\nvar Media_1 = __importDefault(require(\"./components/Media\"));\nvar Blockquote_1 = __importDefault(require(\"./components/Blockquote\"));\nvar CodeBlock_1 = __importDefault(require(\"./components/CodeBlock\"));\nvar UrlPopover_1 = __importDefault(require(\"./components/UrlPopover\"));\nvar Autocomplete_1 = __importDefault(require(\"./components/Autocomplete\"));\nvar utils_1 = require(\"./utils\");\nvar styles = function styles(theme) {\n  var _a, _b, _c, _d, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3, _4;\n  return (0, styles_1.createStyles)({\n    root: ((_b = (_a = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _a === void 0 ? void 0 : _a.MUIRichTextEditor) === null || _b === void 0 ? void 0 : _b.root) || {},\n    container: ((_d = (_c = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _c === void 0 ? void 0 : _c.MUIRichTextEditor) === null || _d === void 0 ? void 0 : _d.container) || {\n      margin: theme.spacing(1, 0, 0, 0),\n      position: \"relative\",\n      fontFamily: theme.typography.body1.fontFamily,\n      fontSize: theme.typography.body1.fontSize,\n      '& figure': {\n        margin: 0\n      }\n    },\n    inheritFontSize: ((_g = (_f = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _f === void 0 ? void 0 : _f.MUIRichTextEditor) === null || _g === void 0 ? void 0 : _g.inheritFontSize) || {\n      fontSize: \"inherit\"\n    },\n    editor: ((_j = (_h = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _h === void 0 ? void 0 : _h.MUIRichTextEditor) === null || _j === void 0 ? void 0 : _j.editor) || {},\n    editorContainer: ((_l = (_k = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _k === void 0 ? void 0 : _k.MUIRichTextEditor) === null || _l === void 0 ? void 0 : _l.editorContainer) || {\n      margin: theme.spacing(1, 0, 0, 0),\n      cursor: \"text\",\n      width: \"100%\",\n      padding: theme.spacing(0, 0, 1, 0)\n    },\n    editorReadOnly: ((_o = (_m = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _m === void 0 ? void 0 : _m.MUIRichTextEditor) === null || _o === void 0 ? void 0 : _o.editorReadOnly) || {\n      borderBottom: \"none\"\n    },\n    error: ((_q = (_p = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _p === void 0 ? void 0 : _p.MUIRichTextEditor) === null || _q === void 0 ? void 0 : _q.error) || {\n      borderBottom: \"2px solid red\"\n    },\n    hidePlaceholder: ((_s = (_r = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _r === void 0 ? void 0 : _r.MUIRichTextEditor) === null || _s === void 0 ? void 0 : _s.hidePlaceholder) || {\n      display: \"none\"\n    },\n    placeHolder: ((_u = (_t = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _t === void 0 ? void 0 : _t.MUIRichTextEditor) === null || _u === void 0 ? void 0 : _u.placeHolder) || {\n      color: theme.palette.grey[600],\n      position: \"absolute\",\n      outline: \"none\"\n    },\n    linkPopover: ((_w = (_v = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _v === void 0 ? void 0 : _v.MUIRichTextEditor) === null || _w === void 0 ? void 0 : _w.linkPopover) || {\n      padding: theme.spacing(2, 2, 2, 2)\n    },\n    linkTextField: ((_y = (_x = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _x === void 0 ? void 0 : _x.MUIRichTextEditor) === null || _y === void 0 ? void 0 : _y.linkTextField) || {\n      width: \"100%\"\n    },\n    anchorLink: ((_0 = (_z = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _z === void 0 ? void 0 : _z.MUIRichTextEditor) === null || _0 === void 0 ? void 0 : _0.anchorLink) || {},\n    toolbar: ((_2 = (_1 = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _1 === void 0 ? void 0 : _1.MUIRichTextEditor) === null || _2 === void 0 ? void 0 : _2.toolbar) || {},\n    inlineToolbar: ((_4 = (_3 = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _3 === void 0 ? void 0 : _3.MUIRichTextEditor) === null || _4 === void 0 ? void 0 : _4.inlineToolbar) || {\n      maxWidth: \"180px\",\n      position: \"absolute\",\n      padding: \"5px\",\n      zIndex: 10\n    }\n  });\n};\nvar blockRenderMap = immutable_1.default.Map({\n  'blockquote': {\n    element: \"blockquote\",\n    wrapper: react_1.default.createElement(Blockquote_1.default, null)\n  },\n  'code-block': {\n    element: \"pre\",\n    wrapper: react_1.default.createElement(CodeBlock_1.default, null)\n  }\n});\nvar styleRenderMap = {\n  'STRIKETHROUGH': {\n    textDecoration: \"line-through\"\n  },\n  'HIGHLIGHT': {\n    backgroundColor: \"yellow\"\n  }\n};\nvar hasCommandModifier = draft_js_1.KeyBindingUtil.hasCommandModifier;\nvar autocompleteMinSearchCharCount = 2;\nvar lineHeight = 26;\nvar defaultInlineToolbarControls = [\"bold\", \"italic\", \"underline\", \"clear\"];\nvar findLinkEntities = function findLinkEntities(contentBlock, callback, contentState) {\n  contentBlock.findEntityRanges(function (character) {\n    var entityKey = character.getEntity();\n    return entityKey !== null && contentState.getEntity(entityKey).getType() === 'LINK';\n  }, callback);\n};\nvar findDecoWithRegex = function findDecoWithRegex(regex, contentBlock, callback) {\n  var text = contentBlock.getText();\n  var matchArr, start;\n  while ((matchArr = regex.exec(text)) !== null) {\n    start = matchArr.index;\n    callback(start, start + matchArr[0].length);\n  }\n};\nvar useEditorState = function useEditorState(props) {\n  var decorators = [{\n    strategy: findLinkEntities,\n    component: Link_1.default\n  }];\n  if (props.decorators) {\n    props.decorators.forEach(function (deco) {\n      return decorators.push({\n        strategy: function strategy(contentBlock, callback) {\n          findDecoWithRegex(deco.regex, contentBlock, callback);\n        },\n        component: deco.component\n      });\n    });\n  }\n  var decorator = new draft_js_1.CompositeDecorator(decorators);\n  var defaultValue = props.defaultValue || props.value;\n  return defaultValue ? draft_js_1.EditorState.createWithContent((0, draft_js_1.convertFromRaw)(JSON.parse(defaultValue)), decorator) : draft_js_1.EditorState.createEmpty(decorator);\n};\nvar MUIRichTextEditor = function MUIRichTextEditor(props, ref) {\n  var _a, _b, _c;\n  var classes = props.classes,\n    controls = props.controls,\n    customControls = props.customControls;\n  var _d = (0, react_1.useState)({}),\n    state = _d[0],\n    setState = _d[1];\n  var _f = (0, react_1.useState)(false),\n    focus = _f[0],\n    setFocus = _f[1];\n  var _g = (0, react_1.useState)(\"\"),\n    searchTerm = _g[0],\n    setSearchTerm = _g[1];\n  var _h = (0, react_1.useState)(0),\n    selectedIndex = _h[0],\n    setSelectedIndex = _h[1];\n  var _j = (0, react_1.useState)(function () {\n      return useEditorState(props);\n    }),\n    editorState = _j[0],\n    setEditorState = _j[1];\n  var _k = (0, react_1.useState)(\"\"),\n    focusMediaKey = _k[0],\n    setFocusMediaKey = _k[1];\n  var editorRef = (0, react_1.useRef)(null);\n  var editorId = props.id || \"mui-rte\";\n  var toolbarPositionRef = (0, react_1.useRef)(undefined);\n  var editorStateRef = (0, react_1.useRef)(editorState);\n  var autocompleteRef = (0, react_1.useRef)(undefined);\n  var autocompleteSelectionStateRef = (0, react_1.useRef)(undefined);\n  var autocompletePositionRef = (0, react_1.useRef)(undefined);\n  var autocompleteLimit = props.autocomplete ? props.autocomplete.suggestLimit || 5 : 5;\n  var isFirstFocus = (0, react_1.useRef)(true);\n  var customBlockMapRef = (0, react_1.useRef)(undefined);\n  var customStyleMapRef = (0, react_1.useRef)(undefined);\n  var isFocusedWithMouse = (0, react_1.useRef)(false);\n  var selectionRef = (0, react_1.useRef)({\n    start: 0,\n    end: 0\n  });\n  /**\n   * Exposed methods\n   */\n  (0, react_1.useImperativeHandle)(ref, function () {\n    return {\n      focus: function focus() {\n        handleFocus();\n      },\n      save: function save() {\n        handleSave();\n      },\n      insertAtomicBlock: function insertAtomicBlock(name, data) {\n        handleInsertAtomicBlockSync(name, data);\n      },\n      insertAtomicBlockSync: function insertAtomicBlockSync(name, data) {\n        handleInsertAtomicBlockSync(name, data);\n      },\n      insertAtomicBlockAsync: function insertAtomicBlockAsync(name, promise, placeholder) {\n        handleInsertAtomicBlockAsync(name, promise, placeholder);\n      }\n    };\n  });\n  (0, react_1.useEffect)(function () {\n    var editorState = useEditorState(props);\n    setEditorState(editorState);\n    toggleMouseUpListener(true);\n    return function () {\n      toggleMouseUpListener();\n    };\n  }, [props.value, props.defaultValue]);\n  (0, react_1.useEffect)(function () {\n    if (props.onChange) {\n      props.onChange(editorState);\n    }\n    editorStateRef.current = editorState;\n  }, [editorState]);\n  (0, react_1.useEffect)(function () {\n    toolbarPositionRef.current = state.toolbarPosition;\n  }, [state.toolbarPosition]);\n  (0, react_1.useEffect)(function () {\n    if (searchTerm.length < autocompleteMinSearchCharCount) {\n      setSelectedIndex(0);\n    }\n  }, [searchTerm]);\n  var clearSearch = function clearSearch() {\n    setSearchTerm(\"\");\n    autocompletePositionRef.current = undefined;\n    autocompleteSelectionStateRef.current = undefined;\n  };\n  var handleMouseUp = function handleMouseUp(event) {\n    var nodeName = event.target.nodeName;\n    clearSearch();\n    if (nodeName === \"IMG\" || nodeName === \"VIDEO\") {\n      return;\n    }\n    setTimeout(function () {\n      var _a;\n      var selection = editorStateRef.current.getSelection();\n      if (selection.isCollapsed() || toolbarPositionRef !== undefined && selectionRef.current.start === selection.getStartOffset() && selectionRef.current.end === selection.getEndOffset()) {\n        var selectionInfo = (0, utils_1.getSelectionInfo)(editorStateRef.current);\n        if (selectionInfo.entityType === \"IMAGE\") {\n          focusMedia(selectionInfo.block);\n          return;\n        }\n        setState(__assign(__assign({}, state), {\n          toolbarPosition: undefined\n        }));\n        return;\n      }\n      selectionRef.current = {\n        start: selection.getStartOffset(),\n        end: selection.getEndOffset()\n      };\n      var editor = (_a = editorRef.current) === null || _a === void 0 ? void 0 : _a.editor;\n      if (!editor) {\n        return;\n      }\n      var _b = (0, utils_1.getEditorBounds)(editor),\n        editorRect = _b.editorRect,\n        selectionRect = _b.selectionRect;\n      if (!selectionRect) {\n        return;\n      }\n      var position = {\n        top: editor.offsetTop - 48 + (selectionRect.top - editorRect.top),\n        left: editor.offsetLeft + (selectionRect.left - editorRect.left)\n      };\n      setState(__assign(__assign({}, state), {\n        toolbarPosition: position\n      }));\n    }, 1);\n  };\n  var findAutocompleteStrategy = function findAutocompleteStrategy(chars) {\n    if (!props.autocomplete) {\n      return undefined;\n    }\n    var acArray = props.autocomplete.strategies.filter(function (ac) {\n      return ac.triggerChar === chars;\n    });\n    if (acArray.length) {\n      return acArray[0];\n    }\n    return undefined;\n  };\n  var updateAutocompletePosition = function updateAutocompletePosition() {\n    var _a;\n    var editor = (_a = editorRef.current) === null || _a === void 0 ? void 0 : _a.editor;\n    if (!editor) {\n      return;\n    }\n    var _b = (0, utils_1.getEditorBounds)(editor),\n      editorRect = _b.editorRect,\n      selectionRect = _b.selectionRect;\n    var line = (0, utils_1.getLineNumber)(editorState);\n    var top = selectionRect ? selectionRect.top : editorRect.top + lineHeight * line;\n    var left = selectionRect ? selectionRect.left : editorRect.left;\n    var position = {\n      top: editor.offsetTop + (top - editorRect.top) + lineHeight,\n      left: editor.offsetLeft + (left - editorRect.left)\n    };\n    if (!autocompleteSelectionStateRef.current) {\n      autocompleteSelectionStateRef.current = editorStateRef.current.getSelection();\n    }\n    autocompletePositionRef.current = position;\n  };\n  var insertAutocompleteSuggestionAsAtomicBlock = function insertAutocompleteSuggestionAsAtomicBlock(name, selection, value) {\n    var block = (0, utils_1.atomicBlockExists)(name, props.customControls);\n    if (!block) {\n      return;\n    }\n    var contentState = draft_js_1.Modifier.removeRange(editorStateRef.current.getCurrentContent(), selection, \"forward\");\n    var newEditorState = draft_js_1.EditorState.push(editorStateRef.current, contentState, \"remove-range\");\n    var withAtomicBlock = insertAtomicBlock(newEditorState, name.toUpperCase(), {\n      value: value\n    }, {\n      selection: newEditorState.getCurrentContent().getSelectionAfter()\n    });\n    handleChange(withAtomicBlock);\n  };\n  var insertAutocompleteSuggestionAsText = function insertAutocompleteSuggestionAsText(selection, value) {\n    var currentContentState = editorState.getCurrentContent();\n    var entityKey = currentContentState.createEntity(\"AC_ITEM\", 'IMMUTABLE').getLastCreatedEntityKey();\n    var contentState = draft_js_1.Modifier.replaceText(editorStateRef.current.getCurrentContent(), selection, value, editorStateRef.current.getCurrentInlineStyle(), entityKey);\n    var newEditorState = draft_js_1.EditorState.push(editorStateRef.current, contentState, \"insert-characters\");\n    if (autocompleteRef.current.insertSpaceAfter === false) {\n      handleChange(newEditorState);\n    } else {\n      var addSpaceState = draft_js_1.Modifier.insertText(newEditorState.getCurrentContent(), newEditorState.getSelection(), \" \", newEditorState.getCurrentInlineStyle());\n      handleChange(draft_js_1.EditorState.push(newEditorState, addSpaceState, \"insert-characters\"));\n    }\n  };\n  var handleAutocompleteSelected = function handleAutocompleteSelected(index) {\n    var itemIndex = index || selectedIndex;\n    var items = getAutocompleteItems();\n    if (items.length > itemIndex) {\n      var item = items[itemIndex];\n      var currentSelection = autocompleteSelectionStateRef.current;\n      var offset = currentSelection.getFocusOffset() + searchTerm.length + 1;\n      var newSelection = currentSelection.merge({\n        'focusOffset': offset\n      });\n      if (autocompleteRef.current.atomicBlockName) {\n        var name_1 = autocompleteRef.current.atomicBlockName;\n        insertAutocompleteSuggestionAsAtomicBlock(name_1, newSelection, item.value);\n      } else {\n        insertAutocompleteSuggestionAsText(newSelection, item.value);\n      }\n    }\n    handleAutocompleteClosed();\n  };\n  var handleAutocompleteClosed = function handleAutocompleteClosed() {\n    clearSearch();\n    setSelectedIndex(0);\n    refocus();\n  };\n  var getAutocompleteItems = function getAutocompleteItems() {\n    if (searchTerm.length < autocompleteMinSearchCharCount) {\n      return [];\n    }\n    return autocompleteRef.current.items.filter(function (item) {\n      return item.keys.filter(function (key) {\n        return key.includes(searchTerm);\n      }).length > 0;\n    }).splice(0, autocompleteLimit);\n  };\n  var handleChange = function handleChange(state) {\n    setEditorState(state);\n  };\n  var handleBeforeInput = function handleBeforeInput(chars, editorState) {\n    if (chars === \" \" && searchTerm.length) {\n      clearSearch();\n    } else if (autocompleteSelectionStateRef.current) {\n      setSearchTerm(searchTerm + chars);\n    } else {\n      var strategy = findAutocompleteStrategy(chars);\n      if (strategy) {\n        autocompleteRef.current = strategy;\n        updateAutocompletePosition();\n      }\n    }\n    return isMaxLengthHandled(editorState, 1);\n  };\n  var handleEditorFocus = function handleEditorFocus() {\n    handleFocus();\n    if (isFocusedWithMouse.current === true) {\n      isFocusedWithMouse.current = false;\n      return;\n    }\n    var nextEditorState = draft_js_1.EditorState.forceSelection(editorState, editorState.getSelection());\n    setTimeout(function () {\n      return setEditorState(draft_js_1.EditorState.moveFocusToEnd(nextEditorState));\n    }, 0);\n  };\n  var handlePlaceholderFocus = function handlePlaceholderFocus() {\n    if (isFirstFocus.current === false) {\n      focusEditor();\n      return;\n    }\n    handleFocus();\n    isFirstFocus.current = false;\n  };\n  var handleFocus = function handleFocus() {\n    focusEditor();\n    if (props.onFocus) {\n      props.onFocus();\n    }\n  };\n  var focusEditor = function focusEditor() {\n    setFocus(true);\n    setTimeout(function () {\n      var _a;\n      return (_a = editorRef.current) === null || _a === void 0 ? void 0 : _a.focus();\n    }, 0);\n  };\n  var handleBlur = function handleBlur() {\n    isFocusedWithMouse.current = false;\n    setFocus(false);\n    if (props.onBlur) {\n      props.onBlur();\n    }\n    if (!state.anchorUrlPopover) {\n      setState(__assign(__assign({}, state), {\n        toolbarPosition: undefined\n      }));\n    }\n  };\n  var handleMouseDown = function handleMouseDown() {\n    isFocusedWithMouse.current = true;\n  };\n  var handleClearFormat = function handleClearFormat() {\n    if (customStyleMapRef.current === undefined) {\n      return;\n    }\n    var withoutStyles = (0, utils_1.clearInlineStyles)(editorState, customStyleMapRef.current);\n    var selectionInfo = (0, utils_1.getSelectionInfo)(editorState);\n    var newEditorState = draft_js_1.EditorState.push(editorState, withoutStyles, 'change-inline-style');\n    setEditorState(draft_js_1.RichUtils.toggleBlockType(newEditorState, selectionInfo.blockType));\n  };\n  var handleSave = function handleSave() {\n    if (props.onSave) {\n      props.onSave(JSON.stringify((0, draft_js_1.convertToRaw)(editorState.getCurrentContent())));\n    }\n  };\n  var handleInsertAtomicBlockSync = function handleInsertAtomicBlockSync(name, data) {\n    var block = (0, utils_1.atomicBlockExists)(name, props.customControls);\n    if (!block) {\n      return;\n    }\n    var newEditorState = insertAtomicBlock(editorState, block.name.toUpperCase(), data, {\n      selection: editorState.getCurrentContent().getSelectionAfter()\n    });\n    updateStateForPopover(newEditorState);\n  };\n  var handleInsertAtomicBlockAsync = function handleInsertAtomicBlockAsync(name, promise, placeholder) {\n    var selection = insertAsyncAtomicBlockPlaceholder(name, placeholder);\n    var offset = selection.getFocusOffset() + 1;\n    var newSelection = selection.merge({\n      'focusOffset': offset\n    });\n    promise.then(function (response) {\n      var newEditorState = insertAtomicBlock(editorStateRef.current, name, response.data, {\n        selection: newSelection\n      });\n      handleChange(newEditorState);\n    }).catch(function (error) {\n      if (error) {\n        return;\n      }\n      var newContentState = draft_js_1.Modifier.removeRange(editorStateRef.current.getCurrentContent(), newSelection, \"forward\");\n      handleChange(draft_js_1.EditorState.push(editorStateRef.current, newContentState, \"remove-range\"));\n    });\n  };\n  var insertAsyncAtomicBlockPlaceholder = function insertAsyncAtomicBlockPlaceholder(name, placeholder) {\n    var placeholderName = placeholder || name + \"...\";\n    var currentContentState = editorStateRef.current.getCurrentContent();\n    var entityKey = currentContentState.createEntity(\"ASYNC_ATOMICBLOCK\", 'IMMUTABLE').getLastCreatedEntityKey();\n    var contentState = draft_js_1.Modifier.insertText(editorStateRef.current.getCurrentContent(), currentContentState.getSelectionAfter(), placeholderName, undefined, entityKey);\n    var selection = currentContentState.getSelectionAfter();\n    var newEditorState = draft_js_1.EditorState.push(editorStateRef.current, contentState, \"insert-characters\");\n    handleChange(newEditorState);\n    return selection;\n  };\n  var handleKeyCommand = function handleKeyCommand(command, editorState) {\n    var newState = draft_js_1.RichUtils.handleKeyCommand(editorState, command);\n    if (newState) {\n      handleChange(newState);\n      return \"handled\";\n    } else {\n      if (command.includes(\"mui-autocomplete\")) {\n        if (command === \"mui-autocomplete-insert\") {\n          handleAutocompleteSelected();\n        }\n        if (command === \"mui-autocomplete-end\") {\n          handleAutocompleteClosed();\n        }\n        return \"handled\";\n      }\n      if (props.keyCommands) {\n        var keyCommand = props.keyCommands.find(function (comm) {\n          return comm.name === command;\n        });\n        if (keyCommand) {\n          var newState_1 = keyCommand.callback(editorState);\n          handleChange(newState_1);\n          return \"handled\";\n        }\n      }\n    }\n    return \"not-handled\";\n  };\n  var handleCustomClick = function handleCustomClick(style, id) {\n    if (!props.customControls) {\n      return;\n    }\n    for (var _i = 0, _a = props.customControls; _i < _a.length; _i++) {\n      var control = _a[_i];\n      if (control.name.toUpperCase() === style) {\n        if (control.onClick) {\n          setTimeout(function () {\n            var _a;\n            return (_a = editorRef.current) === null || _a === void 0 ? void 0 : _a.blur();\n          }, 0);\n          var newState = control.onClick(editorState, control.name, document.getElementById(id));\n          if (newState) {\n            if (newState.getSelection().isCollapsed()) {\n              setEditorState(newState);\n            } else {\n              updateStateForPopover(newState);\n            }\n          } else {\n            if (!editorState.getSelection().isCollapsed()) {\n              refocus();\n            }\n          }\n        }\n        break;\n      }\n    }\n  };\n  var handleUndo = function handleUndo() {\n    setEditorState(draft_js_1.EditorState.undo(editorState));\n  };\n  var handleRedo = function handleRedo() {\n    setEditorState(draft_js_1.EditorState.redo(editorState));\n  };\n  var handlePrompt = function handlePrompt(lastState, type, inlineMode) {\n    var selectionInfo = (0, utils_1.getSelectionInfo)(lastState);\n    var contentState = lastState.getCurrentContent();\n    var linkKey = selectionInfo.linkKey;\n    var data = undefined;\n    if (linkKey) {\n      var linkInstance = contentState.getEntity(linkKey);\n      data = linkInstance.getData();\n    }\n    setState({\n      urlData: data,\n      urlKey: linkKey,\n      toolbarPosition: !inlineMode ? undefined : state.toolbarPosition,\n      anchorUrlPopover: !inlineMode ? document.getElementById(editorId + \"-\" + type + \"-control-button\") : document.getElementById(editorId + \"-\" + type + \"-control-button-toolbar\"),\n      urlIsMedia: type === \"media\" ? true : undefined\n    });\n  };\n  var handlePromptForLink = function handlePromptForLink(inlineMode) {\n    var selection = editorState.getSelection();\n    if (!selection.isCollapsed()) {\n      handlePrompt(editorState, \"link\", inlineMode);\n    }\n  };\n  var handlePromptForMedia = function handlePromptForMedia(inlineMode, newState) {\n    var lastState = newState || editorState;\n    handlePrompt(lastState, \"media\", inlineMode);\n  };\n  var handleConfirmPrompt = function handleConfirmPrompt(isMedia) {\n    var args = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n      args[_i - 1] = arguments[_i];\n    }\n    if (isMedia) {\n      confirmMedia.apply(void 0, args);\n      return;\n    }\n    confirmLink.apply(void 0, args);\n  };\n  var handleToolbarClick = function handleToolbarClick(style, type, id, inlineMode) {\n    if (type === \"inline\") {\n      return toggleInlineStyle(style);\n    }\n    if (type === \"block\") {\n      return toggleBlockType(style);\n    }\n    switch (style) {\n      case \"UNDO\":\n        handleUndo();\n        break;\n      case \"REDO\":\n        handleRedo();\n        break;\n      case \"LINK\":\n        handlePromptForLink(inlineMode);\n        break;\n      case \"IMAGE\":\n        handlePromptForMedia(inlineMode);\n        break;\n      case \"clear\":\n        handleClearFormat();\n        break;\n      case \"save\":\n        handleSave();\n        break;\n      default:\n        handleCustomClick(style, id);\n    }\n  };\n  var handlePastedText = function handlePastedText(text, _html, editorState) {\n    return isMaxLengthHandled(editorState, text.length);\n  };\n  var handleReturn = function handleReturn(_e, editorState) {\n    return isMaxLengthHandled(editorState, 1);\n  };\n  var isMaxLengthHandled = function isMaxLengthHandled(editorState, nextLength) {\n    var currentLength = editorState.getCurrentContent().getPlainText('').length;\n    return (0, utils_1.isGreaterThan)(currentLength + nextLength, props.maxLength) ? \"handled\" : \"not-handled\";\n  };\n  var toggleMouseUpListener = function toggleMouseUpListener(addAfter) {\n    var _a;\n    if (addAfter === void 0) {\n      addAfter = false;\n    }\n    var editor = (_a = editorRef.current) === null || _a === void 0 ? void 0 : _a.editor;\n    if (!editor) {\n      return;\n    }\n    editor.removeEventListener(\"mouseup\", handleMouseUp);\n    if (addAfter) {\n      editor.addEventListener(\"mouseup\", handleMouseUp);\n    }\n  };\n  var removeLink = function removeLink() {\n    var selection = editorState.getSelection();\n    setEditorState(draft_js_1.RichUtils.toggleLink(editorState, selection, null));\n  };\n  var confirmLink = function confirmLink(url) {\n    var urlKey = state.urlKey;\n    if (!url) {\n      if (urlKey) {\n        removeLink();\n      }\n      dismissPopover();\n      return;\n    }\n    var contentState = editorState.getCurrentContent();\n    var replaceEditorState = editorState;\n    var data = {\n      url: url,\n      className: classes.anchorLink\n    };\n    if (urlKey) {\n      contentState.replaceEntityData(urlKey, data);\n      replaceEditorState = draft_js_1.EditorState.push(editorState, contentState, \"apply-entity\");\n    } else {\n      var contentStateWithEntity = contentState.createEntity('LINK', 'MUTABLE', data);\n      var entityKey = contentStateWithEntity.getLastCreatedEntityKey();\n      var newEditorState = draft_js_1.EditorState.set(editorState, {\n        currentContent: contentStateWithEntity\n      });\n      replaceEditorState = draft_js_1.RichUtils.toggleLink(newEditorState, newEditorState.getSelection(), entityKey);\n    }\n    updateStateForPopover(replaceEditorState);\n  };\n  var removeMedia = function removeMedia() {\n    var blockKey = editorState.getSelection().getStartKey();\n    var contentState = editorState.getCurrentContent();\n    var mediaBlock = contentState.getBlockForKey(blockKey);\n    var newContentState = (0, utils_1.removeBlockFromMap)(editorState, mediaBlock);\n    var newEditorState = draft_js_1.EditorState.push(editorState, newContentState, \"remove-range\");\n    setEditorState(newEditorState);\n  };\n  var confirmMedia = function confirmMedia(url, width, height, alignment, type) {\n    var urlKey = state.urlKey;\n    if (!url) {\n      if (urlKey) {\n        removeMedia();\n      }\n      dismissPopover();\n      return;\n    }\n    var contentState = editorState.getCurrentContent();\n    var data = {\n      url: url,\n      width: width,\n      height: height,\n      alignment: alignment,\n      type: type\n    };\n    if (urlKey) {\n      contentState.replaceEntityData(urlKey, data);\n      var newEditorState = draft_js_1.EditorState.push(editorState, contentState, \"apply-entity\");\n      updateStateForPopover(draft_js_1.EditorState.forceSelection(newEditorState, newEditorState.getCurrentContent().getSelectionAfter()));\n    } else {\n      var newEditorState = insertAtomicBlock(editorState, \"IMAGE\", data);\n      updateStateForPopover(draft_js_1.EditorState.forceSelection(newEditorState, newEditorState.getCurrentContent().getSelectionAfter()));\n    }\n    setFocusMediaKey(\"\");\n  };\n  var updateStateForPopover = function updateStateForPopover(editorState) {\n    setEditorState(editorState);\n    dismissPopover();\n  };\n  var dismissPopover = function dismissPopover() {\n    refocus();\n    setState(__assign(__assign({}, state), {\n      anchorUrlPopover: undefined,\n      urlKey: undefined,\n      urlIsMedia: undefined,\n      urlData: undefined\n    }));\n  };\n  var refocus = function refocus() {\n    setTimeout(function () {\n      var _a;\n      return (_a = editorRef.current) === null || _a === void 0 ? void 0 : _a.blur();\n    }, 0);\n    setTimeout(function () {\n      var _a;\n      return (_a = editorRef.current) === null || _a === void 0 ? void 0 : _a.focus();\n    }, 1);\n  };\n  var toggleBlockType = function toggleBlockType(blockType) {\n    setEditorState(draft_js_1.RichUtils.toggleBlockType(editorState, blockType));\n  };\n  var toggleInlineStyle = function toggleInlineStyle(inlineStyle) {\n    setEditorState(draft_js_1.RichUtils.toggleInlineStyle(editorState, inlineStyle));\n  };\n  var focusMedia = function focusMedia(block) {\n    var newSeletion = draft_js_1.SelectionState.createEmpty(block.getKey());\n    var newEditorState = draft_js_1.EditorState.forceSelection(editorStateRef.current, newSeletion);\n    editorStateRef.current = newEditorState;\n    setFocusMediaKey(block.getKey());\n    setEditorState(newEditorState);\n    handlePromptForMedia(false, newEditorState);\n  };\n  var getStyleMap = function getStyleMap() {\n    if (customStyleMapRef.current === undefined) {\n      setupStyleMap();\n    }\n    return customStyleMapRef.current;\n  };\n  var setupStyleMap = function setupStyleMap() {\n    var _a;\n    var customStyleMap = JSON.parse(JSON.stringify(styleRenderMap));\n    (_a = props.customControls) === null || _a === void 0 ? void 0 : _a.filter(function (control) {\n      return control.type === \"inline\" && control.inlineStyle;\n    }).forEach(function (control) {\n      customStyleMap[control.name.toUpperCase()] = control.inlineStyle;\n    });\n    customStyleMapRef.current = customStyleMap;\n  };\n  var getBlockMap = function getBlockMap() {\n    if (customBlockMapRef.current === undefined) {\n      setupBlockMap();\n    }\n    return customBlockMapRef.current;\n  };\n  var setupBlockMap = function setupBlockMap() {\n    var _a;\n    var customBlockMap = {};\n    (_a = props.customControls) === null || _a === void 0 ? void 0 : _a.filter(function (control) {\n      return control.type === \"block\" && control.blockWrapper;\n    }).forEach(function (control) {\n      customBlockMap[control.name.toUpperCase()] = {\n        element: \"div\",\n        wrapper: control.blockWrapper\n      };\n    });\n    customBlockMapRef.current = draft_js_1.DefaultDraftBlockRenderMap.merge(blockRenderMap, immutable_1.default.Map(customBlockMap));\n  };\n  var blockRenderer = function blockRenderer(contentBlock) {\n    var blockType = contentBlock.getType();\n    if (blockType === 'atomic') {\n      var contentState = editorState.getCurrentContent();\n      var entity = contentBlock.getEntityAt(0);\n      if (entity) {\n        var type = contentState.getEntity(entity).getType();\n        if (type === \"IMAGE\") {\n          return {\n            component: Media_1.default,\n            editable: false,\n            props: {\n              onClick: focusMedia,\n              readOnly: props.readOnly,\n              focusKey: focusMediaKey\n            }\n          };\n        } else {\n          var block = (0, utils_1.atomicBlockExists)(type.toLowerCase(), props.customControls);\n          if (block) {\n            return {\n              component: block.atomicComponent,\n              editable: false,\n              props: contentState.getEntity(contentBlock.getEntityAt(0)).getData()\n            };\n          }\n        }\n      }\n    }\n    return null;\n  };\n  var styleRenderer = function styleRenderer(style) {\n    var customStyleMap = getStyleMap();\n    var styleNames = style.toJS();\n    return styleNames.reduce(function (styles, styleName) {\n      styles = customStyleMap[styleName];\n      return styles;\n    }, {});\n  };\n  var insertAtomicBlock = function insertAtomicBlock(editorState, type, data, options) {\n    var contentState = editorState.getCurrentContent();\n    var contentStateWithEntity = contentState.createEntity(type, 'IMMUTABLE', data);\n    var entityKey = contentStateWithEntity.getLastCreatedEntityKey();\n    var newEditorStateRaw = draft_js_1.EditorState.set(editorState, __assign({\n      currentContent: contentStateWithEntity\n    }, options));\n    return draft_js_1.AtomicBlockUtils.insertAtomicBlock(newEditorStateRaw, entityKey, ' ');\n  };\n  var getAutocompleteKeyEvent = function getAutocompleteKeyEvent(keyboardEvent) {\n    var itemsLength = getAutocompleteItems().length;\n    var limit = autocompleteLimit > itemsLength ? itemsLength : autocompleteLimit;\n    switch (keyboardEvent.key) {\n      case \"ArrowDown\":\n        if (selectedIndex === 0 && itemsLength === 1 || selectedIndex + 1 === limit) {\n          setSelectedIndex(0);\n        } else {\n          setSelectedIndex(selectedIndex + 1 < limit ? selectedIndex + 1 : selectedIndex);\n        }\n        return \"mui-autocomplete-navigate\";\n      case \"ArrowUp\":\n        if (selectedIndex) {\n          setSelectedIndex(selectedIndex - 1);\n        } else {\n          setSelectedIndex(limit - 1);\n        }\n        return \"mui-autocomplete-navigate\";\n      case \"Enter\":\n        return \"mui-autocomplete-insert\";\n      case \"Escape\":\n        return \"mui-autocomplete-end\";\n      default:\n        return null;\n    }\n  };\n  var updateSearchTermForKeyBinding = function updateSearchTermForKeyBinding(keyBinding) {\n    var text = editorStateRef.current.getCurrentContent().getLastBlock().getText();\n    if (keyBinding === \"backspace\" && autocompleteRef.current && text.substr(text.length - 1) === autocompleteRef.current.triggerChar) {\n      clearSearch();\n    } else if (autocompletePositionRef.current && keyBinding === \"backspace\" && searchTerm.length) {\n      setSearchTerm(searchTerm.substr(0, searchTerm.length - 1));\n    } else if (!autocompletePositionRef.current && (keyBinding === \"backspace\" || keyBinding === \"split-block\")) {\n      clearSearch();\n    }\n  };\n  var keyBindingFn = function keyBindingFn(e) {\n    if (hasCommandModifier(e) && props.keyCommands) {\n      var comm = props.keyCommands.find(function (comm) {\n        return comm.key === e.keyCode;\n      });\n      if (comm) {\n        return comm.name;\n      }\n    }\n    if (searchTerm) {\n      var autocompleteEvent = getAutocompleteKeyEvent(e);\n      if (autocompleteEvent) {\n        return autocompleteEvent;\n      }\n    }\n    var keyBinding = (0, draft_js_1.getDefaultKeyBinding)(e);\n    updateSearchTermForKeyBinding(keyBinding);\n    return keyBinding;\n  };\n  var renderToolbar = props.toolbar === undefined || props.toolbar;\n  var inlineToolbarControls = props.inlineToolbarControls || defaultInlineToolbarControls;\n  var editable = props.readOnly === undefined || !props.readOnly;\n  var className = \"\";\n  var placeholder = null;\n  if (!focus) {\n    var contentState = editorState.getCurrentContent();\n    if (!contentState.hasText()) {\n      placeholder = react_1.default.createElement(\"div\", {\n        className: (0, classnames_1.default)(classes.editorContainer, classes.placeHolder, (_a = {}, _a[classes.error] = props.error, _a)),\n        tabIndex: 0,\n        onFocus: handlePlaceholderFocus\n      }, props.label || \"\");\n      className = classes.hidePlaceholder;\n    }\n  }\n  return react_1.default.createElement(\"div\", {\n    id: editorId + \"-root\",\n    className: classes.root\n  }, react_1.default.createElement(\"div\", {\n    id: editorId + \"-container\",\n    className: (0, classnames_1.default)(classes.container, (_b = {}, _b[classes.inheritFontSize] = props.inheritFontSize, _b))\n  }, props.autocomplete && autocompletePositionRef.current ? react_1.default.createElement(Autocomplete_1.default, {\n    items: getAutocompleteItems(),\n    top: autocompletePositionRef.current.top,\n    left: autocompletePositionRef.current.left,\n    onClick: handleAutocompleteSelected,\n    selectedIndex: selectedIndex\n  }) : null, props.inlineToolbar && editable && state.toolbarPosition ? react_1.default.createElement(material_1.Paper, {\n    className: classes.inlineToolbar,\n    style: {\n      top: state.toolbarPosition.top,\n      left: state.toolbarPosition.left\n    }\n  }, react_1.default.createElement(Toolbar_1.default, {\n    id: editorId,\n    editorState: editorState,\n    onClick: handleToolbarClick,\n    controls: inlineToolbarControls,\n    customControls: customControls,\n    inlineMode: true,\n    isActive: true\n  })) : null, renderToolbar ? react_1.default.createElement(Toolbar_1.default, {\n    id: editorId,\n    editorState: editorState,\n    onClick: handleToolbarClick,\n    controls: controls,\n    customControls: customControls,\n    className: classes.toolbar,\n    disabled: !editable,\n    size: props.toolbarButtonSize,\n    isActive: focus\n  }) : null, placeholder, react_1.default.createElement(\"div\", {\n    id: editorId + \"-editor\",\n    className: classes.editor\n  }, react_1.default.createElement(\"div\", {\n    id: editorId + \"-editor-container\",\n    className: (0, classnames_1.default)(className, classes.editorContainer, (_c = {}, _c[classes.editorReadOnly] = !editable, _c[classes.error] = props.error, _c)),\n    onMouseDown: handleMouseDown,\n    onBlur: handleBlur\n  }, react_1.default.createElement(draft_js_1.Editor, __assign({\n    blockRenderMap: getBlockMap(),\n    blockRendererFn: blockRenderer,\n    customStyleFn: styleRenderer,\n    editorState: editorState,\n    onChange: handleChange,\n    onFocus: handleEditorFocus,\n    readOnly: props.readOnly,\n    handleKeyCommand: handleKeyCommand,\n    handleBeforeInput: handleBeforeInput,\n    handlePastedText: handlePastedText,\n    handleReturn: handleReturn,\n    keyBindingFn: keyBindingFn,\n    ref: editorRef\n  }, props.draftEditorProps)))), state.anchorUrlPopover ? react_1.default.createElement(UrlPopover_1.default, {\n    data: state.urlData,\n    anchor: state.anchorUrlPopover,\n    onConfirm: handleConfirmPrompt,\n    isMedia: state.urlIsMedia\n  }) : null));\n};\nexports.default = (0, styles_1.withStyles)(styles, {\n  withTheme: true,\n  name: \"MUIRichTextEditor\"\n})((0, react_1.forwardRef)(MUIRichTextEditor));","map":{"version":3,"sources":["../src/MUIRichTextEditor.tsx"],"names":[],"mappings":"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","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar react_1 = __importStar(require(\"react\"));\nvar immutable_1 = __importDefault(require(\"immutable\"));\nvar classnames_1 = __importDefault(require(\"classnames\"));\nvar styles_1 = require(\"@mui/styles\");\nvar material_1 = require(\"@mui/material\");\nvar draft_js_1 = require(\"draft-js\");\nvar Toolbar_1 = __importDefault(require(\"./components/Toolbar\"));\nvar Link_1 = __importDefault(require(\"./components/Link\"));\nvar Media_1 = __importDefault(require(\"./components/Media\"));\nvar Blockquote_1 = __importDefault(require(\"./components/Blockquote\"));\nvar CodeBlock_1 = __importDefault(require(\"./components/CodeBlock\"));\nvar UrlPopover_1 = __importDefault(require(\"./components/UrlPopover\"));\nvar Autocomplete_1 = __importDefault(require(\"./components/Autocomplete\"));\nvar utils_1 = require(\"./utils\");\nvar styles = function (theme) {\n    var _a, _b, _c, _d, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3, _4;\n    return (0, styles_1.createStyles)({\n        root: ((_b = (_a = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _a === void 0 ? void 0 : _a.MUIRichTextEditor) === null || _b === void 0 ? void 0 : _b.root) || {},\n        container: ((_d = (_c = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _c === void 0 ? void 0 : _c.MUIRichTextEditor) === null || _d === void 0 ? void 0 : _d.container) || {\n            margin: theme.spacing(1, 0, 0, 0),\n            position: \"relative\",\n            fontFamily: theme.typography.body1.fontFamily,\n            fontSize: theme.typography.body1.fontSize,\n            '& figure': {\n                margin: 0\n            }\n        },\n        inheritFontSize: ((_g = (_f = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _f === void 0 ? void 0 : _f.MUIRichTextEditor) === null || _g === void 0 ? void 0 : _g.inheritFontSize) || {\n            fontSize: \"inherit\"\n        },\n        editor: ((_j = (_h = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _h === void 0 ? void 0 : _h.MUIRichTextEditor) === null || _j === void 0 ? void 0 : _j.editor) || {},\n        editorContainer: ((_l = (_k = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _k === void 0 ? void 0 : _k.MUIRichTextEditor) === null || _l === void 0 ? void 0 : _l.editorContainer) || {\n            margin: theme.spacing(1, 0, 0, 0),\n            cursor: \"text\",\n            width: \"100%\",\n            padding: theme.spacing(0, 0, 1, 0)\n        },\n        editorReadOnly: ((_o = (_m = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _m === void 0 ? void 0 : _m.MUIRichTextEditor) === null || _o === void 0 ? void 0 : _o.editorReadOnly) || {\n            borderBottom: \"none\"\n        },\n        error: ((_q = (_p = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _p === void 0 ? void 0 : _p.MUIRichTextEditor) === null || _q === void 0 ? void 0 : _q.error) || {\n            borderBottom: \"2px solid red\"\n        },\n        hidePlaceholder: ((_s = (_r = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _r === void 0 ? void 0 : _r.MUIRichTextEditor) === null || _s === void 0 ? void 0 : _s.hidePlaceholder) || {\n            display: \"none\"\n        },\n        placeHolder: ((_u = (_t = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _t === void 0 ? void 0 : _t.MUIRichTextEditor) === null || _u === void 0 ? void 0 : _u.placeHolder) || {\n            color: theme.palette.grey[600],\n            position: \"absolute\",\n            outline: \"none\"\n        },\n        linkPopover: ((_w = (_v = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _v === void 0 ? void 0 : _v.MUIRichTextEditor) === null || _w === void 0 ? void 0 : _w.linkPopover) || {\n            padding: theme.spacing(2, 2, 2, 2)\n        },\n        linkTextField: ((_y = (_x = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _x === void 0 ? void 0 : _x.MUIRichTextEditor) === null || _y === void 0 ? void 0 : _y.linkTextField) || {\n            width: \"100%\"\n        },\n        anchorLink: ((_0 = (_z = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _z === void 0 ? void 0 : _z.MUIRichTextEditor) === null || _0 === void 0 ? void 0 : _0.anchorLink) || {},\n        toolbar: ((_2 = (_1 = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _1 === void 0 ? void 0 : _1.MUIRichTextEditor) === null || _2 === void 0 ? void 0 : _2.toolbar) || {},\n        inlineToolbar: ((_4 = (_3 = theme === null || theme === void 0 ? void 0 : theme.overrides) === null || _3 === void 0 ? void 0 : _3.MUIRichTextEditor) === null || _4 === void 0 ? void 0 : _4.inlineToolbar) || {\n            maxWidth: \"180px\",\n            position: \"absolute\",\n            padding: \"5px\",\n            zIndex: 10\n        }\n    });\n};\nvar blockRenderMap = immutable_1.default.Map({\n    'blockquote': {\n        element: \"blockquote\",\n        wrapper: react_1.default.createElement(Blockquote_1.default, null)\n    },\n    'code-block': {\n        element: \"pre\",\n        wrapper: react_1.default.createElement(CodeBlock_1.default, null)\n    }\n});\nvar styleRenderMap = {\n    'STRIKETHROUGH': {\n        textDecoration: \"line-through\"\n    },\n    'HIGHLIGHT': {\n        backgroundColor: \"yellow\"\n    }\n};\nvar hasCommandModifier = draft_js_1.KeyBindingUtil.hasCommandModifier;\nvar autocompleteMinSearchCharCount = 2;\nvar lineHeight = 26;\nvar defaultInlineToolbarControls = [\"bold\", \"italic\", \"underline\", \"clear\"];\nvar findLinkEntities = function (contentBlock, callback, contentState) {\n    contentBlock.findEntityRanges(function (character) {\n        var entityKey = character.getEntity();\n        return (entityKey !== null &&\n            contentState.getEntity(entityKey).getType() === 'LINK');\n    }, callback);\n};\nvar findDecoWithRegex = function (regex, contentBlock, callback) {\n    var text = contentBlock.getText();\n    var matchArr, start;\n    while ((matchArr = regex.exec(text)) !== null) {\n        start = matchArr.index;\n        callback(start, start + matchArr[0].length);\n    }\n};\nvar useEditorState = function (props) {\n    var decorators = [\n        {\n            strategy: findLinkEntities,\n            component: Link_1.default,\n        }\n    ];\n    if (props.decorators) {\n        props.decorators.forEach(function (deco) { return decorators.push({\n            strategy: function (contentBlock, callback) {\n                findDecoWithRegex(deco.regex, contentBlock, callback);\n            },\n            component: deco.component\n        }); });\n    }\n    var decorator = new draft_js_1.CompositeDecorator(decorators);\n    var defaultValue = props.defaultValue || props.value;\n    return (defaultValue)\n        ? draft_js_1.EditorState.createWithContent((0, draft_js_1.convertFromRaw)(JSON.parse(defaultValue)), decorator)\n        : draft_js_1.EditorState.createEmpty(decorator);\n};\nvar MUIRichTextEditor = function (props, ref) {\n    var _a, _b, _c;\n    var classes = props.classes, controls = props.controls, customControls = props.customControls;\n    var _d = (0, react_1.useState)({}), state = _d[0], setState = _d[1];\n    var _f = (0, react_1.useState)(false), focus = _f[0], setFocus = _f[1];\n    var _g = (0, react_1.useState)(\"\"), searchTerm = _g[0], setSearchTerm = _g[1];\n    var _h = (0, react_1.useState)(0), selectedIndex = _h[0], setSelectedIndex = _h[1];\n    var _j = (0, react_1.useState)(function () { return useEditorState(props); }), editorState = _j[0], setEditorState = _j[1];\n    var _k = (0, react_1.useState)(\"\"), focusMediaKey = _k[0], setFocusMediaKey = _k[1];\n    var editorRef = (0, react_1.useRef)(null);\n    var editorId = props.id || \"mui-rte\";\n    var toolbarPositionRef = (0, react_1.useRef)(undefined);\n    var editorStateRef = (0, react_1.useRef)(editorState);\n    var autocompleteRef = (0, react_1.useRef)(undefined);\n    var autocompleteSelectionStateRef = (0, react_1.useRef)(undefined);\n    var autocompletePositionRef = (0, react_1.useRef)(undefined);\n    var autocompleteLimit = props.autocomplete ? props.autocomplete.suggestLimit || 5 : 5;\n    var isFirstFocus = (0, react_1.useRef)(true);\n    var customBlockMapRef = (0, react_1.useRef)(undefined);\n    var customStyleMapRef = (0, react_1.useRef)(undefined);\n    var isFocusedWithMouse = (0, react_1.useRef)(false);\n    var selectionRef = (0, react_1.useRef)({\n        start: 0,\n        end: 0\n    });\n    /**\n     * Exposed methods\n     */\n    (0, react_1.useImperativeHandle)(ref, function () { return ({\n        focus: function () {\n            handleFocus();\n        },\n        save: function () {\n            handleSave();\n        },\n        insertAtomicBlock: function (name, data) {\n            handleInsertAtomicBlockSync(name, data);\n        },\n        insertAtomicBlockSync: function (name, data) {\n            handleInsertAtomicBlockSync(name, data);\n        },\n        insertAtomicBlockAsync: function (name, promise, placeholder) {\n            handleInsertAtomicBlockAsync(name, promise, placeholder);\n        }\n    }); });\n    (0, react_1.useEffect)(function () {\n        var editorState = useEditorState(props);\n        setEditorState(editorState);\n        toggleMouseUpListener(true);\n        return function () {\n            toggleMouseUpListener();\n        };\n    }, [props.value, props.defaultValue]);\n    (0, react_1.useEffect)(function () {\n        if (props.onChange) {\n            props.onChange(editorState);\n        }\n        editorStateRef.current = editorState;\n    }, [editorState]);\n    (0, react_1.useEffect)(function () {\n        toolbarPositionRef.current = state.toolbarPosition;\n    }, [state.toolbarPosition]);\n    (0, react_1.useEffect)(function () {\n        if (searchTerm.length < autocompleteMinSearchCharCount) {\n            setSelectedIndex(0);\n        }\n    }, [searchTerm]);\n    var clearSearch = function () {\n        setSearchTerm(\"\");\n        autocompletePositionRef.current = undefined;\n        autocompleteSelectionStateRef.current = undefined;\n    };\n    var handleMouseUp = function (event) {\n        var nodeName = event.target.nodeName;\n        clearSearch();\n        if (nodeName === \"IMG\" || nodeName === \"VIDEO\") {\n            return;\n        }\n        setTimeout(function () {\n            var _a;\n            var selection = editorStateRef.current.getSelection();\n            if (selection.isCollapsed() || (toolbarPositionRef !== undefined &&\n                selectionRef.current.start === selection.getStartOffset() &&\n                selectionRef.current.end === selection.getEndOffset())) {\n                var selectionInfo = (0, utils_1.getSelectionInfo)(editorStateRef.current);\n                if (selectionInfo.entityType === \"IMAGE\") {\n                    focusMedia(selectionInfo.block);\n                    return;\n                }\n                setState(__assign(__assign({}, state), { toolbarPosition: undefined }));\n                return;\n            }\n            selectionRef.current = {\n                start: selection.getStartOffset(),\n                end: selection.getEndOffset()\n            };\n            var editor = (_a = editorRef.current) === null || _a === void 0 ? void 0 : _a.editor;\n            if (!editor) {\n                return;\n            }\n            var _b = (0, utils_1.getEditorBounds)(editor), editorRect = _b.editorRect, selectionRect = _b.selectionRect;\n            if (!selectionRect) {\n                return;\n            }\n            var position = {\n                top: editor.offsetTop - 48 + (selectionRect.top - editorRect.top),\n                left: editor.offsetLeft + (selectionRect.left - editorRect.left)\n            };\n            setState(__assign(__assign({}, state), { toolbarPosition: position }));\n        }, 1);\n    };\n    var findAutocompleteStrategy = function (chars) {\n        if (!props.autocomplete) {\n            return undefined;\n        }\n        var acArray = props.autocomplete.strategies.filter(function (ac) { return ac.triggerChar === chars; });\n        if (acArray.length) {\n            return acArray[0];\n        }\n        return undefined;\n    };\n    var updateAutocompletePosition = function () {\n        var _a;\n        var editor = (_a = editorRef.current) === null || _a === void 0 ? void 0 : _a.editor;\n        if (!editor) {\n            return;\n        }\n        var _b = (0, utils_1.getEditorBounds)(editor), editorRect = _b.editorRect, selectionRect = _b.selectionRect;\n        var line = (0, utils_1.getLineNumber)(editorState);\n        var top = selectionRect ? selectionRect.top : editorRect.top + (lineHeight * line);\n        var left = selectionRect ? selectionRect.left : editorRect.left;\n        var position = {\n            top: editor.offsetTop + (top - editorRect.top) + lineHeight,\n            left: editor.offsetLeft + (left - editorRect.left)\n        };\n        if (!autocompleteSelectionStateRef.current) {\n            autocompleteSelectionStateRef.current = editorStateRef.current.getSelection();\n        }\n        autocompletePositionRef.current = position;\n    };\n    var insertAutocompleteSuggestionAsAtomicBlock = function (name, selection, value) {\n        var block = (0, utils_1.atomicBlockExists)(name, props.customControls);\n        if (!block) {\n            return;\n        }\n        var contentState = draft_js_1.Modifier.removeRange(editorStateRef.current.getCurrentContent(), selection, \"forward\");\n        var newEditorState = draft_js_1.EditorState.push(editorStateRef.current, contentState, \"remove-range\");\n        var withAtomicBlock = insertAtomicBlock(newEditorState, name.toUpperCase(), {\n            value: value\n        }, {\n            selection: newEditorState.getCurrentContent().getSelectionAfter()\n        });\n        handleChange(withAtomicBlock);\n    };\n    var insertAutocompleteSuggestionAsText = function (selection, value) {\n        var currentContentState = editorState.getCurrentContent();\n        var entityKey = currentContentState.createEntity(\"AC_ITEM\", 'IMMUTABLE').getLastCreatedEntityKey();\n        var contentState = draft_js_1.Modifier.replaceText(editorStateRef.current.getCurrentContent(), selection, value, editorStateRef.current.getCurrentInlineStyle(), entityKey);\n        var newEditorState = draft_js_1.EditorState.push(editorStateRef.current, contentState, \"insert-characters\");\n        if (autocompleteRef.current.insertSpaceAfter === false) {\n            handleChange(newEditorState);\n        }\n        else {\n            var addSpaceState = draft_js_1.Modifier.insertText(newEditorState.getCurrentContent(), newEditorState.getSelection(), \" \", newEditorState.getCurrentInlineStyle());\n            handleChange(draft_js_1.EditorState.push(newEditorState, addSpaceState, \"insert-characters\"));\n        }\n    };\n    var handleAutocompleteSelected = function (index) {\n        var itemIndex = index || selectedIndex;\n        var items = getAutocompleteItems();\n        if (items.length > itemIndex) {\n            var item = items[itemIndex];\n            var currentSelection = autocompleteSelectionStateRef.current;\n            var offset = currentSelection.getFocusOffset() + searchTerm.length + 1;\n            var newSelection = currentSelection.merge({\n                'focusOffset': offset\n            });\n            if (autocompleteRef.current.atomicBlockName) {\n                var name_1 = autocompleteRef.current.atomicBlockName;\n                insertAutocompleteSuggestionAsAtomicBlock(name_1, newSelection, item.value);\n            }\n            else {\n                insertAutocompleteSuggestionAsText(newSelection, item.value);\n            }\n        }\n        handleAutocompleteClosed();\n    };\n    var handleAutocompleteClosed = function () {\n        clearSearch();\n        setSelectedIndex(0);\n        refocus();\n    };\n    var getAutocompleteItems = function () {\n        if (searchTerm.length < autocompleteMinSearchCharCount) {\n            return [];\n        }\n        return autocompleteRef.current.items\n            .filter(function (item) { return (item.keys.filter(function (key) { return key.includes(searchTerm); }).length > 0); })\n            .splice(0, autocompleteLimit);\n    };\n    var handleChange = function (state) {\n        setEditorState(state);\n    };\n    var handleBeforeInput = function (chars, editorState) {\n        if (chars === \" \" && searchTerm.length) {\n            clearSearch();\n        }\n        else if (autocompleteSelectionStateRef.current) {\n            setSearchTerm(searchTerm + chars);\n        }\n        else {\n            var strategy = findAutocompleteStrategy(chars);\n            if (strategy) {\n                autocompleteRef.current = strategy;\n                updateAutocompletePosition();\n            }\n        }\n        return isMaxLengthHandled(editorState, 1);\n    };\n    var handleEditorFocus = function () {\n        handleFocus();\n        if (isFocusedWithMouse.current === true) {\n            isFocusedWithMouse.current = false;\n            return;\n        }\n        var nextEditorState = draft_js_1.EditorState.forceSelection(editorState, editorState.getSelection());\n        setTimeout(function () { return (setEditorState(draft_js_1.EditorState.moveFocusToEnd(nextEditorState))); }, 0);\n    };\n    var handlePlaceholderFocus = function () {\n        if (isFirstFocus.current === false) {\n            focusEditor();\n            return;\n        }\n        handleFocus();\n        isFirstFocus.current = false;\n    };\n    var handleFocus = function () {\n        focusEditor();\n        if (props.onFocus) {\n            props.onFocus();\n        }\n    };\n    var focusEditor = function () {\n        setFocus(true);\n        setTimeout(function () { var _a; return (_a = editorRef.current) === null || _a === void 0 ? void 0 : _a.focus(); }, 0);\n    };\n    var handleBlur = function () {\n        isFocusedWithMouse.current = false;\n        setFocus(false);\n        if (props.onBlur) {\n            props.onBlur();\n        }\n        if (!state.anchorUrlPopover) {\n            setState(__assign(__assign({}, state), { toolbarPosition: undefined }));\n        }\n    };\n    var handleMouseDown = function () {\n        isFocusedWithMouse.current = true;\n    };\n    var handleClearFormat = function () {\n        if (customStyleMapRef.current === undefined) {\n            return;\n        }\n        var withoutStyles = (0, utils_1.clearInlineStyles)(editorState, customStyleMapRef.current);\n        var selectionInfo = (0, utils_1.getSelectionInfo)(editorState);\n        var newEditorState = draft_js_1.EditorState.push(editorState, withoutStyles, 'change-inline-style');\n        setEditorState(draft_js_1.RichUtils.toggleBlockType(newEditorState, selectionInfo.blockType));\n    };\n    var handleSave = function () {\n        if (props.onSave) {\n            props.onSave(JSON.stringify((0, draft_js_1.convertToRaw)(editorState.getCurrentContent())));\n        }\n    };\n    var handleInsertAtomicBlockSync = function (name, data) {\n        var block = (0, utils_1.atomicBlockExists)(name, props.customControls);\n        if (!block) {\n            return;\n        }\n        var newEditorState = insertAtomicBlock(editorState, block.name.toUpperCase(), data, {\n            selection: editorState.getCurrentContent().getSelectionAfter()\n        });\n        updateStateForPopover(newEditorState);\n    };\n    var handleInsertAtomicBlockAsync = function (name, promise, placeholder) {\n        var selection = insertAsyncAtomicBlockPlaceholder(name, placeholder);\n        var offset = selection.getFocusOffset() + 1;\n        var newSelection = selection.merge({\n            'focusOffset': offset\n        });\n        promise.then(function (response) {\n            var newEditorState = insertAtomicBlock(editorStateRef.current, name, response.data, {\n                selection: newSelection\n            });\n            handleChange(newEditorState);\n        }).catch(function (error) {\n            if (error) {\n                return;\n            }\n            var newContentState = draft_js_1.Modifier.removeRange(editorStateRef.current.getCurrentContent(), newSelection, \"forward\");\n            handleChange(draft_js_1.EditorState.push(editorStateRef.current, newContentState, \"remove-range\"));\n        });\n    };\n    var insertAsyncAtomicBlockPlaceholder = function (name, placeholder) {\n        var placeholderName = placeholder || name + \"...\";\n        var currentContentState = editorStateRef.current.getCurrentContent();\n        var entityKey = currentContentState.createEntity(\"ASYNC_ATOMICBLOCK\", 'IMMUTABLE').getLastCreatedEntityKey();\n        var contentState = draft_js_1.Modifier.insertText(editorStateRef.current.getCurrentContent(), currentContentState.getSelectionAfter(), placeholderName, undefined, entityKey);\n        var selection = currentContentState.getSelectionAfter();\n        var newEditorState = draft_js_1.EditorState.push(editorStateRef.current, contentState, \"insert-characters\");\n        handleChange(newEditorState);\n        return selection;\n    };\n    var handleKeyCommand = function (command, editorState) {\n        var newState = draft_js_1.RichUtils.handleKeyCommand(editorState, command);\n        if (newState) {\n            handleChange(newState);\n            return \"handled\";\n        }\n        else {\n            if (command.includes(\"mui-autocomplete\")) {\n                if (command === \"mui-autocomplete-insert\") {\n                    handleAutocompleteSelected();\n                }\n                if (command === \"mui-autocomplete-end\") {\n                    handleAutocompleteClosed();\n                }\n                return \"handled\";\n            }\n            if (props.keyCommands) {\n                var keyCommand = props.keyCommands.find(function (comm) { return comm.name === command; });\n                if (keyCommand) {\n                    var newState_1 = keyCommand.callback(editorState);\n                    handleChange(newState_1);\n                    return \"handled\";\n                }\n            }\n        }\n        return \"not-handled\";\n    };\n    var handleCustomClick = function (style, id) {\n        if (!props.customControls) {\n            return;\n        }\n        for (var _i = 0, _a = props.customControls; _i < _a.length; _i++) {\n            var control = _a[_i];\n            if (control.name.toUpperCase() === style) {\n                if (control.onClick) {\n                    setTimeout(function () { var _a; return (_a = editorRef.current) === null || _a === void 0 ? void 0 : _a.blur(); }, 0);\n                    var newState = control.onClick(editorState, control.name, document.getElementById(id));\n                    if (newState) {\n                        if (newState.getSelection().isCollapsed()) {\n                            setEditorState(newState);\n                        }\n                        else {\n                            updateStateForPopover(newState);\n                        }\n                    }\n                    else {\n                        if (!editorState.getSelection().isCollapsed()) {\n                            refocus();\n                        }\n                    }\n                }\n                break;\n            }\n        }\n    };\n    var handleUndo = function () {\n        setEditorState(draft_js_1.EditorState.undo(editorState));\n    };\n    var handleRedo = function () {\n        setEditorState(draft_js_1.EditorState.redo(editorState));\n    };\n    var handlePrompt = function (lastState, type, inlineMode) {\n        var selectionInfo = (0, utils_1.getSelectionInfo)(lastState);\n        var contentState = lastState.getCurrentContent();\n        var linkKey = selectionInfo.linkKey;\n        var data = undefined;\n        if (linkKey) {\n            var linkInstance = contentState.getEntity(linkKey);\n            data = linkInstance.getData();\n        }\n        setState({\n            urlData: data,\n            urlKey: linkKey,\n            toolbarPosition: !inlineMode ? undefined : state.toolbarPosition,\n            anchorUrlPopover: !inlineMode ? document.getElementById(editorId + \"-\" + type + \"-control-button\")\n                : document.getElementById(editorId + \"-\" + type + \"-control-button-toolbar\"),\n            urlIsMedia: type === \"media\" ? true : undefined\n        });\n    };\n    var handlePromptForLink = function (inlineMode) {\n        var selection = editorState.getSelection();\n        if (!selection.isCollapsed()) {\n            handlePrompt(editorState, \"link\", inlineMode);\n        }\n    };\n    var handlePromptForMedia = function (inlineMode, newState) {\n        var lastState = newState || editorState;\n        handlePrompt(lastState, \"media\", inlineMode);\n    };\n    var handleConfirmPrompt = function (isMedia) {\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        if (isMedia) {\n            confirmMedia.apply(void 0, args);\n            return;\n        }\n        confirmLink.apply(void 0, args);\n    };\n    var handleToolbarClick = function (style, type, id, inlineMode) {\n        if (type === \"inline\") {\n            return toggleInlineStyle(style);\n        }\n        if (type === \"block\") {\n            return toggleBlockType(style);\n        }\n        switch (style) {\n            case \"UNDO\":\n                handleUndo();\n                break;\n            case \"REDO\":\n                handleRedo();\n                break;\n            case \"LINK\":\n                handlePromptForLink(inlineMode);\n                break;\n            case \"IMAGE\":\n                handlePromptForMedia(inlineMode);\n                break;\n            case \"clear\":\n                handleClearFormat();\n                break;\n            case \"save\":\n                handleSave();\n                break;\n            default:\n                handleCustomClick(style, id);\n        }\n    };\n    var handlePastedText = function (text, _html, editorState) {\n        return isMaxLengthHandled(editorState, text.length);\n    };\n    var handleReturn = function (_e, editorState) {\n        return isMaxLengthHandled(editorState, 1);\n    };\n    var isMaxLengthHandled = function (editorState, nextLength) {\n        var currentLength = editorState.getCurrentContent().getPlainText('').length;\n        return (0, utils_1.isGreaterThan)(currentLength + nextLength, props.maxLength) ? \"handled\" : \"not-handled\";\n    };\n    var toggleMouseUpListener = function (addAfter) {\n        var _a;\n        if (addAfter === void 0) { addAfter = false; }\n        var editor = (_a = editorRef.current) === null || _a === void 0 ? void 0 : _a.editor;\n        if (!editor) {\n            return;\n        }\n        editor.removeEventListener(\"mouseup\", handleMouseUp);\n        if (addAfter) {\n            editor.addEventListener(\"mouseup\", handleMouseUp);\n        }\n    };\n    var removeLink = function () {\n        var selection = editorState.getSelection();\n        setEditorState(draft_js_1.RichUtils.toggleLink(editorState, selection, null));\n    };\n    var confirmLink = function (url) {\n        var urlKey = state.urlKey;\n        if (!url) {\n            if (urlKey) {\n                removeLink();\n            }\n            dismissPopover();\n            return;\n        }\n        var contentState = editorState.getCurrentContent();\n        var replaceEditorState = editorState;\n        var data = {\n            url: url,\n            className: classes.anchorLink\n        };\n        if (urlKey) {\n            contentState.replaceEntityData(urlKey, data);\n            replaceEditorState = draft_js_1.EditorState.push(editorState, contentState, \"apply-entity\");\n        }\n        else {\n            var contentStateWithEntity = contentState.createEntity('LINK', 'MUTABLE', data);\n            var entityKey = contentStateWithEntity.getLastCreatedEntityKey();\n            var newEditorState = draft_js_1.EditorState.set(editorState, { currentContent: contentStateWithEntity });\n            replaceEditorState = draft_js_1.RichUtils.toggleLink(newEditorState, newEditorState.getSelection(), entityKey);\n        }\n        updateStateForPopover(replaceEditorState);\n    };\n    var removeMedia = function () {\n        var blockKey = editorState.getSelection().getStartKey();\n        var contentState = editorState.getCurrentContent();\n        var mediaBlock = contentState.getBlockForKey(blockKey);\n        var newContentState = (0, utils_1.removeBlockFromMap)(editorState, mediaBlock);\n        var newEditorState = draft_js_1.EditorState.push(editorState, newContentState, \"remove-range\");\n        setEditorState(newEditorState);\n    };\n    var confirmMedia = function (url, width, height, alignment, type) {\n        var urlKey = state.urlKey;\n        if (!url) {\n            if (urlKey) {\n                removeMedia();\n            }\n            dismissPopover();\n            return;\n        }\n        var contentState = editorState.getCurrentContent();\n        var data = {\n            url: url,\n            width: width,\n            height: height,\n            alignment: alignment,\n            type: type\n        };\n        if (urlKey) {\n            contentState.replaceEntityData(urlKey, data);\n            var newEditorState = draft_js_1.EditorState.push(editorState, contentState, \"apply-entity\");\n            updateStateForPopover(draft_js_1.EditorState.forceSelection(newEditorState, newEditorState.getCurrentContent().getSelectionAfter()));\n        }\n        else {\n            var newEditorState = insertAtomicBlock(editorState, \"IMAGE\", data);\n            updateStateForPopover(draft_js_1.EditorState.forceSelection(newEditorState, newEditorState.getCurrentContent().getSelectionAfter()));\n        }\n        setFocusMediaKey(\"\");\n    };\n    var updateStateForPopover = function (editorState) {\n        setEditorState(editorState);\n        dismissPopover();\n    };\n    var dismissPopover = function () {\n        refocus();\n        setState(__assign(__assign({}, state), { anchorUrlPopover: undefined, urlKey: undefined, urlIsMedia: undefined, urlData: undefined }));\n    };\n    var refocus = function () {\n        setTimeout(function () { var _a; return (_a = editorRef.current) === null || _a === void 0 ? void 0 : _a.blur(); }, 0);\n        setTimeout(function () { var _a; return (_a = editorRef.current) === null || _a === void 0 ? void 0 : _a.focus(); }, 1);\n    };\n    var toggleBlockType = function (blockType) {\n        setEditorState(draft_js_1.RichUtils.toggleBlockType(editorState, blockType));\n    };\n    var toggleInlineStyle = function (inlineStyle) {\n        setEditorState(draft_js_1.RichUtils.toggleInlineStyle(editorState, inlineStyle));\n    };\n    var focusMedia = function (block) {\n        var newSeletion = draft_js_1.SelectionState.createEmpty(block.getKey());\n        var newEditorState = draft_js_1.EditorState.forceSelection(editorStateRef.current, newSeletion);\n        editorStateRef.current = newEditorState;\n        setFocusMediaKey(block.getKey());\n        setEditorState(newEditorState);\n        handlePromptForMedia(false, newEditorState);\n    };\n    var getStyleMap = function () {\n        if (customStyleMapRef.current === undefined) {\n            setupStyleMap();\n        }\n        return customStyleMapRef.current;\n    };\n    var setupStyleMap = function () {\n        var _a;\n        var customStyleMap = JSON.parse(JSON.stringify(styleRenderMap));\n        (_a = props.customControls) === null || _a === void 0 ? void 0 : _a.filter(function (control) { return control.type === \"inline\" && control.inlineStyle; }).forEach(function (control) {\n            customStyleMap[control.name.toUpperCase()] = control.inlineStyle;\n        });\n        customStyleMapRef.current = customStyleMap;\n    };\n    var getBlockMap = function () {\n        if (customBlockMapRef.current === undefined) {\n            setupBlockMap();\n        }\n        return customBlockMapRef.current;\n    };\n    var setupBlockMap = function () {\n        var _a;\n        var customBlockMap = {};\n        (_a = props.customControls) === null || _a === void 0 ? void 0 : _a.filter(function (control) { return control.type === \"block\" && control.blockWrapper; }).forEach(function (control) {\n            customBlockMap[control.name.toUpperCase()] = {\n                element: \"div\",\n                wrapper: control.blockWrapper\n            };\n        });\n        customBlockMapRef.current = draft_js_1.DefaultDraftBlockRenderMap.merge(blockRenderMap, immutable_1.default.Map(customBlockMap));\n    };\n    var blockRenderer = function (contentBlock) {\n        var blockType = contentBlock.getType();\n        if (blockType === 'atomic') {\n            var contentState = editorState.getCurrentContent();\n            var entity = contentBlock.getEntityAt(0);\n            if (entity) {\n                var type = contentState.getEntity(entity).getType();\n                if (type === \"IMAGE\") {\n                    return {\n                        component: Media_1.default,\n                        editable: false,\n                        props: {\n                            onClick: focusMedia,\n                            readOnly: props.readOnly,\n                            focusKey: focusMediaKey\n                        }\n                    };\n                }\n                else {\n                    var block = (0, utils_1.atomicBlockExists)(type.toLowerCase(), props.customControls);\n                    if (block) {\n                        return {\n                            component: block.atomicComponent,\n                            editable: false,\n                            props: contentState.getEntity(contentBlock.getEntityAt(0)).getData()\n                        };\n                    }\n                }\n            }\n        }\n        return null;\n    };\n    var styleRenderer = function (style) {\n        var customStyleMap = getStyleMap();\n        var styleNames = style.toJS();\n        return styleNames.reduce(function (styles, styleName) {\n            styles = customStyleMap[styleName];\n            return styles;\n        }, {});\n    };\n    var insertAtomicBlock = function (editorState, type, data, options) {\n        var contentState = editorState.getCurrentContent();\n        var contentStateWithEntity = contentState.createEntity(type, 'IMMUTABLE', data);\n        var entityKey = contentStateWithEntity.getLastCreatedEntityKey();\n        var newEditorStateRaw = draft_js_1.EditorState.set(editorState, __assign({ currentContent: contentStateWithEntity }, options));\n        return draft_js_1.AtomicBlockUtils.insertAtomicBlock(newEditorStateRaw, entityKey, ' ');\n    };\n    var getAutocompleteKeyEvent = function (keyboardEvent) {\n        var itemsLength = getAutocompleteItems().length;\n        var limit = autocompleteLimit > itemsLength ? itemsLength : autocompleteLimit;\n        switch (keyboardEvent.key) {\n            case \"ArrowDown\":\n                if ((selectedIndex === 0 && itemsLength === 1) || (selectedIndex + 1 === limit)) {\n                    setSelectedIndex(0);\n                }\n                else {\n                    setSelectedIndex(selectedIndex + 1 < limit ? selectedIndex + 1 : selectedIndex);\n                }\n                return \"mui-autocomplete-navigate\";\n            case \"ArrowUp\":\n                if (selectedIndex) {\n                    setSelectedIndex(selectedIndex - 1);\n                }\n                else {\n                    setSelectedIndex(limit - 1);\n                }\n                return \"mui-autocomplete-navigate\";\n            case \"Enter\":\n                return \"mui-autocomplete-insert\";\n            case \"Escape\":\n                return \"mui-autocomplete-end\";\n            default:\n                return null;\n        }\n    };\n    var updateSearchTermForKeyBinding = function (keyBinding) {\n        var text = editorStateRef.current.getCurrentContent().getLastBlock().getText();\n        if (keyBinding === \"backspace\"\n            && autocompleteRef.current\n            && text.substr(text.length - 1) === autocompleteRef.current.triggerChar) {\n            clearSearch();\n        }\n        else if (autocompletePositionRef.current\n            && keyBinding === \"backspace\"\n            && searchTerm.length) {\n            setSearchTerm(searchTerm.substr(0, searchTerm.length - 1));\n        }\n        else if (!autocompletePositionRef.current &&\n            (keyBinding === \"backspace\"\n                || keyBinding === \"split-block\")) {\n            clearSearch();\n        }\n    };\n    var keyBindingFn = function (e) {\n        if (hasCommandModifier(e) && props.keyCommands) {\n            var comm = props.keyCommands.find(function (comm) { return comm.key === e.keyCode; });\n            if (comm) {\n                return comm.name;\n            }\n        }\n        if (searchTerm) {\n            var autocompleteEvent = getAutocompleteKeyEvent(e);\n            if (autocompleteEvent) {\n                return autocompleteEvent;\n            }\n        }\n        var keyBinding = (0, draft_js_1.getDefaultKeyBinding)(e);\n        updateSearchTermForKeyBinding(keyBinding);\n        return keyBinding;\n    };\n    var renderToolbar = props.toolbar === undefined || props.toolbar;\n    var inlineToolbarControls = props.inlineToolbarControls || defaultInlineToolbarControls;\n    var editable = props.readOnly === undefined || !props.readOnly;\n    var className = \"\";\n    var placeholder = null;\n    if (!focus) {\n        var contentState = editorState.getCurrentContent();\n        if (!contentState.hasText()) {\n            placeholder = (react_1.default.createElement(\"div\", { className: (0, classnames_1.default)(classes.editorContainer, classes.placeHolder, (_a = {},\n                    _a[classes.error] = props.error,\n                    _a)), tabIndex: 0, onFocus: handlePlaceholderFocus }, props.label || \"\"));\n            className = classes.hidePlaceholder;\n        }\n    }\n    return (react_1.default.createElement(\"div\", { id: editorId + \"-root\", className: classes.root },\n        react_1.default.createElement(\"div\", { id: editorId + \"-container\", className: (0, classnames_1.default)(classes.container, (_b = {},\n                _b[classes.inheritFontSize] = props.inheritFontSize,\n                _b)) },\n            props.autocomplete && autocompletePositionRef.current ?\n                react_1.default.createElement(Autocomplete_1.default, { items: getAutocompleteItems(), top: autocompletePositionRef.current.top, left: autocompletePositionRef.current.left, onClick: handleAutocompleteSelected, selectedIndex: selectedIndex })\n                : null,\n            props.inlineToolbar && editable && state.toolbarPosition ?\n                react_1.default.createElement(material_1.Paper, { className: classes.inlineToolbar, style: {\n                        top: state.toolbarPosition.top,\n                        left: state.toolbarPosition.left\n                    } },\n                    react_1.default.createElement(Toolbar_1.default, { id: editorId, editorState: editorState, onClick: handleToolbarClick, controls: inlineToolbarControls, customControls: customControls, inlineMode: true, isActive: true }))\n                : null,\n            renderToolbar ?\n                react_1.default.createElement(Toolbar_1.default, { id: editorId, editorState: editorState, onClick: handleToolbarClick, controls: controls, customControls: customControls, className: classes.toolbar, disabled: !editable, size: props.toolbarButtonSize, isActive: focus })\n                : null,\n            placeholder,\n            react_1.default.createElement(\"div\", { id: editorId + \"-editor\", className: classes.editor },\n                react_1.default.createElement(\"div\", { id: editorId + \"-editor-container\", className: (0, classnames_1.default)(className, classes.editorContainer, (_c = {},\n                        _c[classes.editorReadOnly] = !editable,\n                        _c[classes.error] = props.error,\n                        _c)), onMouseDown: handleMouseDown, onBlur: handleBlur },\n                    react_1.default.createElement(draft_js_1.Editor, __assign({ blockRenderMap: getBlockMap(), blockRendererFn: blockRenderer, customStyleFn: styleRenderer, editorState: editorState, onChange: handleChange, onFocus: handleEditorFocus, readOnly: props.readOnly, handleKeyCommand: handleKeyCommand, handleBeforeInput: handleBeforeInput, handlePastedText: handlePastedText, handleReturn: handleReturn, keyBindingFn: keyBindingFn, ref: editorRef }, props.draftEditorProps)))),\n            state.anchorUrlPopover ?\n                react_1.default.createElement(UrlPopover_1.default, { data: state.urlData, anchor: state.anchorUrlPopover, onConfirm: handleConfirmPrompt, isMedia: state.urlIsMedia })\n                : null)));\n};\nexports.default = (0, styles_1.withStyles)(styles, { withTheme: true, name: \"MUIRichTextEditor\" })((0, react_1.forwardRef)(MUIRichTextEditor));\n"]},"metadata":{},"sourceType":"script"}